{% extends "base.html" %}

{% block title %}번역 - 위카아라이 검수시스템{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="page-header">
        <button onclick="window.close()" class="btn btn-outline-secondary mb-3">
            <i class="bi bi-arrow-left"></i> 이전페이지로
        </button>
        <h2><i class="bi bi-translate"></i> 일본어 번역</h2>
    </div>
    
    <div class="table-container">
        <table class="table table-bordered">
            <tr>
                <th width="150">신청일</th>
                <td>{{ request_info.request_date or '' }}</td>
                <th width="150">차량번호</th>
                <td>{{ request_info.vehicle_number or '' }}</td>
            </tr>
            <tr>
                <th>출품번호</th>
                <td>{{ request_info.lot_number or '' }}</td>
                <th>주차번호</th>
                <td>{{ request_info.parking_number or '' }}</td>
            </tr>
            <tr>
                <th>신청자</th>
                <td>{{ request_info.user_name or '' }}</td>
                <th>평가사명</th>
                <td>{{ request_info.evaluator_name or '' }}</td>
            </tr>
        </table>
    </div>
    
    <div class="table-container">
        <h4 class="mb-3">검수신청 및 답변내역 (일본어)</h4>
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th width="80">순</th>
                        <th>검수신청내역</th>
                        <th>답변내역</th>
                        <th>비고</th>
                    </tr>
                </thead>
                <tbody id="translatedTable">
                    {% for detail in inspection_details %}
                    <tr>
                        <td>{{ detail.sequence }}</td>
                        <td class="translate-target" data-text="{{ detail.content }}">{{ detail.content }}</td>
                        <td class="translate-target" data-text="{% for resp_detail in response_details %}{% if resp_detail.sequence == detail.sequence %}{{ resp_detail.content }}{% endif %}{% endfor %}">
                            {% for resp_detail in response_details %}
                                {% if resp_detail.sequence == detail.sequence %}
                                    {{ resp_detail.content }}
                                {% endif %}
                            {% endfor %}
                        </td>
                        <td>
                            {% for resp_detail in response_details %}
                                {% if resp_detail.sequence == detail.sequence %}
                                    {{ resp_detail.note or '' }}
                                {% endif %}
                            {% endfor %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="text-center mt-3">
            <button class="btn btn-primary" onclick="translateAll()">
                <i class="bi bi-translate"></i> 번역하기
            </button>
        </div>
    </div>
    
    <div class="text-center my-4">
        <img src="{{ url_for('static', filename='images/lpgo.png') }}" alt="위카 로고" style="max-width: 150px;">
        <p class="mt-2"><strong>위카모빌리티 주식회사</strong></p>
    </div>
    
    <div class="text-center mb-4">
        <button class="btn btn-primary" onclick="exportExcel()">
            <i class="bi bi-file-earmark-excel"></i> 엑셀저장
        </button>
        <button class="btn btn-danger" onclick="exportPDF()">
            <i class="bi bi-file-earmark-pdf"></i> PDF저장
        </button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function translateAll() {
    $('.translate-target').each(function() {
        const $this = $(this);
        const text = $this.data('text');
        if (text) {
            $this.html('<span class="spinner-border spinner-border-sm"></span> 번역중...');
            $.ajax({
                url: '/api/translate',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({text: text, target: 'ja'}),
                success: function(response) {
                    if (response.success) {
                        $this.html(response.translated);
                    } else {
                        $this.html(text);
                    }
                },
                error: function() {
                    $this.html(text);
                }
            });
        }
    });
}

function exportExcel() {
    window.print();
}

function exportPDF() {
    window.print();
}
</script>
{% endblock %}





